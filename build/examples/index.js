import { __awaiter } from "tslib";
import axios from 'axios';
import { v1 as uuidV1 } from 'uuid';
// import { ENV } from '../common/config';
import { getMessenger } from '../index';
import { localStg } from '../utils';
const baseURL = 'http://localhost:7000';
const localUid = localStg.get('messengerDeviceUid');
const uid = localUid ? localUid : uuidV1();
localStg.set('messengerDeviceUid', uid);
const chatId = '66cc25d3c1875cfa0dddfa20'; // ! rm
const apiKey = 'qalqon';
const apiHash = '66b3576d917425b29a3e3644';
const messenger = getMessenger({
    baseURL,
    apiKey,
    apiHash,
    languageGetter() {
        return 'Uz-Latin';
    },
    token: () => __awaiter(void 0, void 0, void 0, function* () {
        const token = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoyMDA5LCJ1c2VybmFtZSI6IlVtYXJiZWsiLCJmdWxsX25hbWUiOiJBS0JBUk9WIFVNQVIiLCJwaG9uZV9udW1iZXIiOiIrOTk4OTQ1NDM0NTY3IiwiZ3JvdXAiOnsiaWQiOjIsIm5hbWUiOiJBZG1pbiIsImFjY2Vzc2VzIjpbM119LCJvcmdhbml6YXRpb25faWQiOm51bGwsInNlcnZpY2VzIjpbeyJpZCI6MiwibmFtZSI6Im50ZmFjZSIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NiwibmFtZSI6InhhdGxvdiIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6MTQsIm5hbWUiOiJlbWVobW9uIiwic3RhdHVzIjp0cnVlfSx7ImlkIjoxNiwibmFtZSI6ImF1dG8tdHJhbnNwb3J0Iiwic3RhdHVzIjp0cnVlfSx7ImlkIjoxOCwibmFtZSI6ImFjY2lkZW50cyIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6MjAsIm5hbWUiOiJkaGEiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjIxLCJuYW1lIjoiZm9ybWExIiwic3RhdHVzIjp0cnVlfSx7ImlkIjoyMiwibmFtZSI6Iml2c3MtbWFuYWdlciIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6MjcsIm5hbWUiOiJxdWljay1zZWFyY2giLCJzdGF0dXMiOnRydWV9LHsiaWQiOjI5LCJuYW1lIjoiY2FtZXJhIiwic3RhdHVzIjp0cnVlfSx7ImlkIjozMCwibmFtZSI6ImZ2diIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6MzEsIm5hbWUiOiJncHMiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjMyLCJuYW1lIjoic2F5bG92Iiwic3RhdHVzIjp0cnVlfSx7ImlkIjozNCwibmFtZSI6Imxpc3RlZC1wZW9wbGUiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjM2LCJuYW1lIjoidGFkYmlyIiwic3RhdHVzIjp0cnVlfSx7ImlkIjozOCwibmFtZSI6Im10cCIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NDAsIm5hbWUiOiJjcmltZSIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NDEsIm5hbWUiOiJjYXIiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjQyLCJuYW1lIjoib3BnIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo0MywibmFtZSI6Im1pYiIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NDQsIm5hbWUiOiJzZXJ2aWNlIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo0NSwibmFtZSI6Im5vdGlmaWNhdGlvbnMiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjQ2LCJuYW1lIjoidGVlbmFnZXJzIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo0NywibmFtZSI6ImJ1cy1wYXJraW5nIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo0OCwibmFtZSI6ImRldGVjdG9yIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo0OSwibmFtZSI6ImFkZC1jYW1lcmEiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjUwLCJuYW1lIjoiaXZzcy1jb250cm9sIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo1MSwibmFtZSI6IjV0YXNoYWJidXMiLCJzdGF0dXMiOnRydWV9LHsiaWQiOjUyLCJuYW1lIjoibG9nZ2VyIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo1MywibmFtZSI6InNjbyIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NTQsIm5hbWUiOiJsYW5ndWFnZSIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NTUsIm5hbWUiOiJzdXBlcnZpc29yIiwic3RhdHVzIjp0cnVlfSx7ImlkIjo1NywibmFtZSI6Im15LWluc3BlY3RvciIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NTksIm5hbWUiOiJib2R5LWNhbWVyYSIsInN0YXR1cyI6dHJ1ZX0seyJpZCI6NjAsIm5hbWUiOiJlbWlncmFudCIsInN0YXR1cyI6dHJ1ZX1dLCJkaXN0cmljdElkIjpudWxsLCJoYXNoIjoiNWE5NzA3MDg4ZDNmMzJiNjY1ZDQ2NGY1YmY0N2M2YzAifSwiaWF0IjoxNzI0NjU0Mzg5LCJleHAiOjE3MjQ3NDA3ODl9.qiVN8V5xdSYknXHReqIV8ZTuMxqeSUpswP-0YSlsjrM';
        const { data } = yield axios.create({ baseURL }).get(`/v1/auth/me-from?token=${token}`, {
            headers: {
                Authorization: `Basic ${btoa(`${apiKey}:${apiHash}`)}`,
            },
        });
        return {
            access: data.data.token.accessToken,
            refresh: data.data.token.refreshToken,
        };
        // const res = await axios.post(
        //   `${baseURL}/v1/auth/login`,
        //   {
        //     username: 'Umarkhan', // Adhamjon, Umarkhan
        //     password: '123',
        //   },
        //   {
        //     headers: requiredHeaders,
        //   },
        // );
        // return {
        //   access: res.data.data.token.accessToken,
        //   refresh: res.data.data.token.refreshToken,
        // };
    }),
    polling: { interval: 5000, limit: 100 },
});
console.log('Success started');
messenger
    .on('connect', (...args) => {
    console.log('connected', args);
})
    .on('reconnect_attempt', (...args) => {
    console.log('reconnect_attempt', args);
})
    .on('reconnect', (...args) => {
    console.log('reconnect', args);
})
    .on('disconnect', ({ reason, details }) => {
    console.log('disconnect', reason);
})
    .on('pong', () => {
    console.log('pong');
})
    .on('update', (data) => {
    console.log(data._id, 'update');
})
    .on('chatAction', (action) => {
    console.log(action, 'chatAction');
});
const getRadomNumber = (from, to) => from + Math.round(Math.random() * (to - from));
setInterval(() => __awaiter(void 0, void 0, void 0, function* () {
    let message;
    const random = getRadomNumber(0, 100);
    // const random = 3;
    if (random % 2 === 0) {
        message = {
            messageType: 'text',
            to: { chatType: 'private', chatId: chatId },
            text: `Test xabar ${Math.random() * 100}. Time: ${new Date().toISOString()}`,
        };
    }
    else {
        const wanted = {
            type: 'user',
            title: 'MVD-Qidiruv',
            user: {
                firstName: 'Qumriniso',
                image: 'http://localhost:3000/v1/files/profile_photos/d1df88dc-62b6-4ba7-9a5f-9669be9040a3.JPEG',
                // fullImage: 'http://localhost:3000/v1/files/profile_photos/d1df88dc-62b6-4ba7-9a5f-9669be9040a3.JPEG',
                lastName: 'Qambarov',
                middleName: 'Qulmiddin qizi',
                fullName: 'Qambarov Qumriniso Qulmiddin qizi',
                pAddress: 'Qashqadaryo Viloyat, Kitob Tuman, Qashqir qishloq',
                passport: 'AA8432720',
                birthDate: '19.05.1981',
            },
            car: {
                carImage: 'http://localhost:3000/v1/files/profile_photos/d1df88dc-62b6-4ba7-9a5f-9669be9040a3.JPEG',
                carNumber: '01O010OO',
            },
            images: [
                'http://localhost:3000/v1/files/profile_photos/d1df88dc-62b6-4ba7-9a5f-9669be9040a3.JPEG',
            ],
            // fullImages: ['http://localhost:3000/v1/files/profile_photos/d1df88dc-62b6-4ba7-9a5f-9669be9040a3.JPEG'],
            initiator: 'ЖАЛАКУДУКСКИЙ РОВД',
            address: 'Туркистон кўчаси, Dehqon bozori',
            text: `Test xabar ${Math.random() * 100}. Time: ${new Date().toISOString()}`,
            mera: 'АРЕСТ',
            region: 'ОЛМАЛИК ШАҲРИ',
            statya: '139 ч.3 п.А;140 ч.1',
            rozType: 'МЕЖГОСУДАРСТВЕННЫЙ Р',
            sender: {
                firstName: 'MAMURAXON',
                lastName: 'ASADOVA',
                middleName: 'CHIRMASHEVNA',
                fullName: 'ASADOVA MAMURAXON CHIRMASHEVNA',
            },
            location: [40.84764631407434, 69.61757628864146],
            // fullImage: 'ivss_images/full_image_0ab1cece-d8bc-42ea-af6a-067206810dbd.jpg',
            // takenImage: 'ivss_images/taken_image_47fbc602-65ea-460a-bbd8-051c9df946f0.jpg',
            objectName: 'Дехқон бозори',
            wantedDate: new Date('07.31.2019').toISOString(),
        };
        if (random % 3 === 0) {
            wanted.user = null;
            wanted.type = 'car';
        }
        else {
            wanted.car = null;
        }
        message = {
            messageType: 'wanted',
            to: { chatType: 'private', chatId: chatId },
            wanted: wanted,
            text: null,
        };
    }
    yield messenger
        .sendMessage(message)
        .then((res) => {
        console.log(res, 'Success sended');
        return res.data;
    })
        .catch((err) => {
        var _a;
        console.log((_a = err.response) === null || _a === void 0 ? void 0 : _a.data, 'err');
    });
}), 1000);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXhhbXBsZXMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMxQixPQUFPLEVBQUUsRUFBRSxJQUFJLE1BQU0sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwQywwQ0FBMEM7QUFDMUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN4QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBSXBDLE1BQU0sT0FBTyxHQUFHLHVCQUF1QixDQUFDO0FBQ3hDLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNwRCxNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDM0MsUUFBUSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUV4QyxNQUFNLE1BQU0sR0FBRywwQkFBMEIsQ0FBQyxDQUFDLE9BQU87QUFFbEQsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDO0FBQ3hCLE1BQU0sT0FBTyxHQUFHLDBCQUEwQixDQUFDO0FBQzNDLE1BQU0sU0FBUyxHQUFHLFlBQVksQ0FBQztJQUM3QixPQUFPO0lBQ1AsTUFBTTtJQUNOLE9BQU87SUFDUCxjQUFjO1FBQ1osT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUNELEtBQUssRUFBRSxHQUdKLEVBQUU7UUFDSCxNQUFNLEtBQUssR0FDVCw4MUVBQTgxRSxDQUFDO1FBQ2oyRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLEtBQUssRUFBRSxFQUFFO1lBQ3RGLE9B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LElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRTtTQUNqRCxDQUFDO1FBQ0YsSUFBSSxNQUFNLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ25CLE1BQU0sQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLENBQUM7YUFBTSxDQUFDO1lBQ04sTUFBTSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDcEIsQ0FBQztRQUVELE9BQU8sR0FBRztZQUNSLFdBQVcsRUFBRSxRQUFRO1lBQ3JCLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRTtZQUMzQyxNQUFNLEVBQUUsTUFBTTtZQUNkLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztJQUNKLENBQUM7SUFFRCxNQUFNLFNBQVM7U0FDWixXQUFXLENBQUMsT0FBTyxDQUFDO1NBQ3BCLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1FBQ1osT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUNuQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDbEIsQ0FBQyxDQUFDO1NBQ0QsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7O1FBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFBLEdBQUcsQ0FBQyxRQUFRLDBDQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQSxFQUFFLElBQUssQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcclxuaW1wb3J0IHsgdjEgYXMgdXVpZFYxIH0gZnJvbSAndXVpZCc7XHJcbi8vIGltcG9ydCB7IEVOViB9IGZyb20gJy4uL2NvbW1vbi9jb25maWcnO1xyXG5pbXBvcnQgeyBnZXRNZXNzZW5nZXIgfSBmcm9tICcuLi9pbmRleCc7XHJcbmltcG9ydCB7IGxvY2FsU3RnIH0gZnJvbSAnLi4vdXRpbHMnO1xyXG5pbXBvcnQgeyBJT25VcGRhdGUgfSBmcm9tICcuLi90eXBlcy9hcGkvbWVzc2FnZS50eXBlcyc7XHJcbmltcG9ydCB7IElDaGF0TWVzc2FnZVdhbnRlZCwgSVNlbmRNZXNzYWdlIH0gZnJvbSAnLi4vdHlwZXMvYXBpL21lc3NhZ2UnO1xyXG5cclxuY29uc3QgYmFzZVVSTCA9ICdodHRwOi8vbG9jYWxob3N0OjcwMDAnO1xyXG5jb25zdCBsb2NhbFVpZCA9IGxvY2FsU3RnLmdldCgnbWVzc2VuZ2VyRGV2aWNlVWlkJyk7XHJcbmNvbnN0IHVpZCA9IGxvY2FsVWlkID8gbG9jYWxVaWQgOiB1dWlkVjEoKTtcclxubG9jYWxTdGcuc2V0KCdtZXNzZW5nZXJEZXZpY2VVaWQnLCB1aWQpO1xyXG5cclxuY29uc3QgY2hhdElkID0gJzY2Y2MyNWQzYzE4NzVjZmEwZGRkZmEyMCc7IC8vICEgcm1cclxuXHJcbmNvbnN0IGFwaUtleSA9ICdxYWxxb24nO1xyXG5jb25zdCBhcGlIYXNoID0gJzY2YjM1NzZkOTE3NDI1YjI5YTNlMzY0NCc7XHJcbmNvbnN0IG1lc3NlbmdlciA9IGdldE1lc3Nlbmdlcih7XHJcbiAgYmFzZVVSTCxcclxuICBhcGlLZXksXHJcbiAgYXBpSGFzaCxcclxuICBsYW5ndWFnZUdldHRlcigpIHtcclxuICAgIHJldHVybiAnVXotTGF0aW4nO1xyXG4gIH0sXHJcbiAgdG9rZW46IGFzeW5jICgpOiBQcm9taXNlPHtcclxuICAgIGFjY2Vzczogc3RyaW5nO1xyXG4gICAgcmVmcmVzaDogc3RyaW5nO1xyXG4gIH0+ID0+IHtcclxuICAgIGNvbnN0IHRva2VuID1cclxuICAgICAgJ0JlYXJlciBleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlJanA3SW1sa0lqb3lNREE1TENKMWMyVnlibUZ0WlNJNklsVnRZWEppWldzaUxDSm1kV3hzWDI1aGJXVWlPaUpCUzBKQlVrOVdJRlZOUVZJaUxDSndhRzl1WlY5dWRXMWlaWElpT2lJck9UazRPVFExTkRNME5UWTNJaXdpWjNKdmRYQWlPbnNpYVdRaU9qSXNJbTVoYldVaU9pSkJaRzFwYmlJc0ltRmpZMlZ6YzJWeklqcGJNMTE5TENKdmNtZGhibWw2WVhScGIyNWZhV1FpT201MWJHd3NJbk5sY25acFkyVnpJanBiZXlKcFpDSTZNaXdpYm1GdFpTSTZJbTUwWm1GalpTSXNJbk4wWVhSMWN5STZkSEoxWlgwc2V5SnBaQ0k2Tml3aWJtRnRaU0k2SW5oaGRHeHZkaUlzSW5OMFlYUjFjeUk2ZEhKMVpYMHNleUpwWkNJNk1UUXNJbTVoYldVaU9pSmxiV1ZvYlc5dUlpd2ljM1JoZEhWeklqcDBjblZsZlN4N0ltbGtJam94Tml3aWJtRnRaU0k2SW1GMWRHOHRkSEpoYm5Od2IzSjBJaXdpYzNSaGRIVnpJanAwY25WbGZTeDdJbWxrSWpveE9Dd2libUZ0WlNJNkltRmpZMmxrWlc1MGN5SXNJbk4wWVhSMWN5STZkSEoxWlgwc2V5SnBaQ0k2TWpBc0ltNWhiV1VpT2lKa2FHRWlMQ0p6ZEdGMGRYTWlPblJ5ZFdWOUxIc2lhV1FpT2pJeExDSnVZVzFsSWpvaVptOXliV0V4SWl3aWMzUmhkSFZ6SWpwMGNuVmxmU3g3SW1sa0lqb3lNaXdpYm1GdFpTSTZJbWwyYzNNdGJXRnVZV2RsY2lJc0luTjBZWFIxY3lJNmRISjFaWDBzZXlKcFpDSTZNamNzSW01aGJXVWlPaUp4ZFdsamF5MXpaV0Z5WTJnaUxDSnpkR0YwZFhNaU9uUnlkV1Y5TEhzaWFXUWlPakk1TENKdVlXMWxJam9pWTJGdFpYSmhJaXdpYzNSaGRIVnpJanAwY25WbGZTeDdJbWxrSWpvek1Dd2libUZ0WlNJNkltWjJkaUlzSW5OMFlYUjFjeUk2ZEhKMVpYMHNleUpwWkNJNk16RXNJbTVoYldVaU9pSm5jSE1pTENKemRHRjBkWE1pT25SeWRXVjlMSHNpYVdRaU9qTXlMQ0p1WVcxbElqb2ljMkY1Ykc5Mklpd2ljM1JoZEhWeklqcDBjblZsZlN4N0ltbGtJam96TkN3aWJtRnRaU0k2SW14cGMzUmxaQzF3Wlc5d2JHVWlMQ0p6ZEdGMGRYTWlPblJ5ZFdWOUxIc2lhV1FpT2pNMkxDSnVZVzFsSWpvaWRHRmtZbWx5SWl3aWMzUmhkSFZ6SWpwMGNuVmxmU3g3SW1sa0lqb3pPQ3dpYm1GdFpTSTZJbTEwY0NJc0luTjBZWFIxY3lJNmRISjFaWDBzZXlKcFpDSTZOREFzSW01aGJXVWlPaUpqY21sdFpTSXNJbk4wWVhSMWN5STZkSEoxWlgwc2V5SnBaQ0k2TkRFc0ltNWhiV1VpT2lKallYSWlMQ0p6ZEdGMGRYTWlPblJ5ZFdWOUxIc2lhV1FpT2pReUxDSnVZVzFsSWpvaWIzQm5JaXdpYzNSaGRIVnpJanAwY25WbGZTeDdJbWxrSWpvME15d2libUZ0WlNJNkltMXBZaUlzSW5OMFlYUjFjeUk2ZEhKMVpYMHNleUpwWkNJNk5EUXNJbTVoYldVaU9pSnpaWEoyYVdObElpd2ljM1JoZEhWeklqcDBjblZsZlN4N0ltbGtJam8wTlN3aWJtRnRaU0k2SW01dmRHbG1hV05oZEdsdmJuTWlMQ0p6ZEdGMGRYTWlPblJ5ZFdWOUxIc2lhV1FpT2pRMkxDSnVZVzFsSWpvaWRHVmxibUZuWlhKeklpd2ljM1JoZEhWeklqcDBjblZsZlN4N0ltbGtJam8wTnl3aWJtRnRaU0k2SW1KMWN5MXdZWEpyYVc1bklpd2ljM1JoZEhWeklqcDBjblZsZlN4N0ltbGtJam8wT0N3aWJtRnRaU0k2SW1SbGRHVmpkRzl5SWl3aWMzUmhkSFZ6SWpwMGNuVmxmU3g3SW1sa0lqbzBPU3dpYm1GdFpTSTZJbUZrWkMxallXMWxjbUVpTENKemRHRjBkWE1pT25SeWRXVjlMSHNpYVdRaU9qVXdMQ0p1WVcxbElqb2lhWFp6Y3kxamIyNTBjbTlzSWl3aWMzUmhkSFZ6SWpwMGNuVmxmU3g3SW1sa0lqbzFNU3dpYm1GdFpTSTZJalYwWVhOb1lXSmlkWE1pTENKemRHRjBkWE1pT25SeWRXVjlMSHNpYVdRaU9qVXlMQ0p1WVcxbElqb2liRzluWjJWeUlpd2ljM1JoZEhWeklqcDBjblZsZlN4N0ltbGtJam8xTXl3aWJtRnRaU0k2SW5OamJ5SXNJbk4wWVhSMWN5STZkSEoxWlgwc2V5SnBaQ0k2TlRRc0ltNWhiV1VpT2lKc1lXNW5kV0ZuWlNJc0luTjBZWFIxY3lJNmRISjFaWDBzZXlKcFpDSTZOVFVzSW01aGJXVWlPaUp6ZFhCbGNuWnBjMjl5SWl3aWMzUmhkSFZ6SWpwMGNuVmxmU3g3SW1sa0lqbzFOeXdpYm1GdFpTSTZJbTE1TFdsdWMzQmxZM1J2Y2lJc0luTjBZWFIxY3lJNmRISjFaWDBzZXlKcFpDSTZOVGtzSW01aGJXVWlPaUppYjJSNUxXTmhiV1Z5WVNJc0luTjBZWFIxY3lJNmRISjFaWDBzZXlKcFpDSTZOakFzSW01aGJXVWlPaUpsYldsbmNtRnVkQ0lzSW5OMFlYUjFjeUk2ZEhKMVpYMWRMQ0prYVhOMGNtbGpkRWxrSWpwdWRXeHNMQ0pvWVhOb0lqb2lOV0U1TnpBM01EZzRaRE5tTXpKaU5qWTFaRFEyTkdZMVltWTBOMk0yWXpBaWZTd2lhV0YwSWpveE56STBOalUwTXpnNUxDSmxlSEFpT2pFM01qUTNOREEzT0RsOS5xaVZOOFY1eGRTWWtuWEhSZXFJVjhaVHVNeHFlU1Vwc3dQLTBZU2xzanJNJztcclxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MuY3JlYXRlKHsgYmFzZVVSTCB9KS5nZXQoYC92MS9hdXRoL21lLWZyb20/dG9rZW49JHt0b2tlbn1gLCB7XHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmFzaWMgJHtidG9hKGAke2FwaUtleX06JHthcGlIYXNofWApfWAsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhY2Nlc3M6IGRhdGEuZGF0YS50b2tlbi5hY2Nlc3NUb2tlbixcclxuICAgICAgcmVmcmVzaDogZGF0YS5kYXRhLnRva2VuLnJlZnJlc2hUb2tlbixcclxuICAgIH07XHJcbiAgICAvLyBjb25zdCByZXMgPSBhd2FpdCBheGlvcy5wb3N0KFxyXG4gICAgLy8gICBgJHtiYXNlVVJMfS92MS9hdXRoL2xvZ2luYCxcclxuICAgIC8vICAge1xyXG4gICAgLy8gICAgIHVzZXJuYW1lOiAnVW1hcmtoYW4nLCAvLyBBZGhhbWpvbiwgVW1hcmtoYW5cclxuICAgIC8vICAgICBwYXNzd29yZDogJzEyMycsXHJcbiAgICAvLyAgIH0sXHJcbiAgICAvLyAgIHtcclxuICAgIC8vICAgICBoZWFkZXJzOiByZXF1aXJlZEhlYWRlcnMsXHJcbiAgICAvLyAgIH0sXHJcbiAgICAvLyApO1xyXG5cclxuICAgIC8vIHJldHVybiB7XHJcbiAgICAvLyAgIGFjY2VzczogcmVzLmRhdGEuZGF0YS50b2tlbi5hY2Nlc3NUb2tlbixcclxuICAgIC8vICAgcmVmcmVzaDogcmVzLmRhdGEuZGF0YS50b2tlbi5yZWZyZXNoVG9rZW4sXHJcbiAgICAvLyB9O1xyXG4gIH0sXHJcbiAgcG9sbGluZzogeyBpbnRlcnZhbDogNV8wMDAsIGxpbWl0OiAxMDAgfSxcclxufSk7XHJcblxyXG5jb25zb2xlLmxvZygnU3VjY2VzcyBzdGFydGVkJyk7XHJcblxyXG5tZXNzZW5nZXJcclxuICAub24oJ2Nvbm5lY3QnLCAoLi4uYXJncykgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2Nvbm5lY3RlZCcsIGFyZ3MpO1xyXG4gIH0pXHJcbiAgLm9uKCdyZWNvbm5lY3RfYXR0ZW1wdCcsICguLi5hcmdzKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygncmVjb25uZWN0X2F0dGVtcHQnLCBhcmdzKTtcclxuICB9KVxyXG4gIC5vbigncmVjb25uZWN0JywgKC4uLmFyZ3MpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKCdyZWNvbm5lY3QnLCBhcmdzKTtcclxuICB9KVxyXG4gIC5vbignZGlzY29ubmVjdCcsICh7IHJlYXNvbiwgZGV0YWlscyB9KSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnZGlzY29ubmVjdCcsIHJlYXNvbik7XHJcbiAgfSlcclxuICAub24oJ3BvbmcnLCAoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygncG9uZycpO1xyXG4gIH0pXHJcbiAgLm9uKCd1cGRhdGUnLCAoZGF0YTogSU9uVXBkYXRlKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhLl9pZCwgJ3VwZGF0ZScpO1xyXG4gIH0pXHJcbiAgLm9uKCdjaGF0QWN0aW9uJywgKGFjdGlvbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coYWN0aW9uLCAnY2hhdEFjdGlvbicpO1xyXG4gIH0pO1xyXG5cclxuY29uc3QgZ2V0UmFkb21OdW1iZXIgPSAoZnJvbTogbnVtYmVyLCB0bzogbnVtYmVyKSA9PiBmcm9tICsgTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogKHRvIC0gZnJvbSkpO1xyXG5cclxuc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xyXG4gIGxldCBtZXNzYWdlOiBJU2VuZE1lc3NhZ2U7XHJcbiAgY29uc3QgcmFuZG9tID0gZ2V0UmFkb21OdW1iZXIoMCwgMTAwKTtcclxuICAvLyBjb25zdCByYW5kb20gPSAzO1xyXG4gIGlmIChyYW5kb20gJSAyID09PSAwKSB7XHJcbiAgICBtZXNzYWdlID0ge1xyXG4gICAgICBtZXNzYWdlVHlwZTogJ3RleHQnLFxyXG4gICAgICB0bzogeyBjaGF0VHlwZTogJ3ByaXZhdGUnLCBjaGF0SWQ6IGNoYXRJZCB9LFxyXG4gICAgICB0ZXh0OiBgVGVzdCB4YWJhciAke01hdGgucmFuZG9tKCkgKiAxMDB9LiBUaW1lOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1gLFxyXG4gICAgfTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3Qgd2FudGVkOiBJQ2hhdE1lc3NhZ2VXYW50ZWQgPSB7XHJcbiAgICAgIHR5cGU6ICd1c2VyJyxcclxuICAgICAgdGl0bGU6ICdNVkQtUWlkaXJ1dicsXHJcbiAgICAgIHVzZXI6IHtcclxuICAgICAgICBmaXJzdE5hbWU6ICdRdW1yaW5pc28nLFxyXG4gICAgICAgIGltYWdlOlxyXG4gICAgICAgICAgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC92MS9maWxlcy9wcm9maWxlX3Bob3Rvcy9kMWRmODhkYy02MmI2LTRiYTctOWE1Zi05NjY5YmU5MDQwYTMuSlBFRycsXHJcbiAgICAgICAgLy8gZnVsbEltYWdlOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL3YxL2ZpbGVzL3Byb2ZpbGVfcGhvdG9zL2QxZGY4OGRjLTYyYjYtNGJhNy05YTVmLTk2NjliZTkwNDBhMy5KUEVHJyxcclxuICAgICAgICBsYXN0TmFtZTogJ1FhbWJhcm92JyxcclxuICAgICAgICBtaWRkbGVOYW1lOiAnUXVsbWlkZGluIHFpemknLFxyXG4gICAgICAgIGZ1bGxOYW1lOiAnUWFtYmFyb3YgUXVtcmluaXNvIFF1bG1pZGRpbiBxaXppJyxcclxuICAgICAgICBwQWRkcmVzczogJ1Fhc2hxYWRhcnlvIFZpbG95YXQsIEtpdG9iIFR1bWFuLCBRYXNocWlyIHFpc2hsb3EnLFxyXG4gICAgICAgIHBhc3Nwb3J0OiAnQUE4NDMyNzIwJyxcclxuICAgICAgICBiaXJ0aERhdGU6ICcxOS4wNS4xOTgxJyxcclxuICAgICAgfSxcclxuICAgICAgY2FyOiB7XHJcbiAgICAgICAgY2FySW1hZ2U6XHJcbiAgICAgICAgICAnaHR0cDovL2xvY2FsaG9zdDozMDAwL3YxL2ZpbGVzL3Byb2ZpbGVfcGhvdG9zL2QxZGY4OGRjLTYyYjYtNGJhNy05YTVmLTk2NjliZTkwNDBhMy5KUEVHJyxcclxuICAgICAgICBjYXJOdW1iZXI6ICcwMU8wMTBPTycsXHJcbiAgICAgIH0sXHJcbiAgICAgIGltYWdlczogW1xyXG4gICAgICAgICdodHRwOi8vbG9jYWxob3N0OjMwMDAvdjEvZmlsZXMvcHJvZmlsZV9waG90b3MvZDFkZjg4ZGMtNjJiNi00YmE3LTlhNWYtOTY2OWJlOTA0MGEzLkpQRUcnLFxyXG4gICAgICBdLFxyXG4gICAgICAvLyBmdWxsSW1hZ2VzOiBbJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC92MS9maWxlcy9wcm9maWxlX3Bob3Rvcy9kMWRmODhkYy02MmI2LTRiYTctOWE1Zi05NjY5YmU5MDQwYTMuSlBFRyddLFxyXG4gICAgICBpbml0aWF0b3I6ICfQltCQ0JvQkNCa0KPQlNCj0JrQodCa0JjQmSDQoNCe0JLQlCcsXHJcbiAgICAgIGFkZHJlc3M6ICfQotGD0YDQutC40YHRgtC+0L0g0LrRntGH0LDRgdC4LCBEZWhxb24gYm96b3JpJyxcclxuICAgICAgdGV4dDogYFRlc3QgeGFiYXIgJHtNYXRoLnJhbmRvbSgpICogMTAwfS4gVGltZTogJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9YCxcclxuXHJcbiAgICAgIG1lcmE6ICfQkNCg0JXQodCiJyxcclxuICAgICAgcmVnaW9uOiAn0J7Qm9Cc0JDQm9CY0Jog0KjQkNKy0KDQmCcsXHJcbiAgICAgIHN0YXR5YTogJzEzOSDRhy4zINC/LtCQOzE0MCDRhy4xJyxcclxuICAgICAgcm96VHlwZTogJ9Cc0JXQltCT0J7QodCj0JTQkNCg0KHQotCS0JXQndCd0KvQmSDQoCcsXHJcbiAgICAgIHNlbmRlcjoge1xyXG4gICAgICAgIGZpcnN0TmFtZTogJ01BTVVSQVhPTicsXHJcbiAgICAgICAgbGFzdE5hbWU6ICdBU0FET1ZBJyxcclxuICAgICAgICBtaWRkbGVOYW1lOiAnQ0hJUk1BU0hFVk5BJyxcclxuICAgICAgICBmdWxsTmFtZTogJ0FTQURPVkEgTUFNVVJBWE9OIENISVJNQVNIRVZOQScsXHJcbiAgICAgIH0sXHJcbiAgICAgIGxvY2F0aW9uOiBbNDAuODQ3NjQ2MzE0MDc0MzQsIDY5LjYxNzU3NjI4ODY0MTQ2XSxcclxuICAgICAgLy8gZnVsbEltYWdlOiAnaXZzc19pbWFnZXMvZnVsbF9pbWFnZV8wYWIxY2VjZS1kOGJjLTQyZWEtYWY2YS0wNjcyMDY4MTBkYmQuanBnJyxcclxuICAgICAgLy8gdGFrZW5JbWFnZTogJ2l2c3NfaW1hZ2VzL3Rha2VuX2ltYWdlXzQ3ZmJjNjAyLTY1ZWEtNDYwYS1iYmQ4LTA1MWM5ZGY5NDZmMC5qcGcnLFxyXG4gICAgICBvYmplY3ROYW1lOiAn0JTQtdGF0pvQvtC9INCx0L7Qt9C+0YDQuCcsXHJcbiAgICAgIHdhbnRlZERhdGU6IG5ldyBEYXRlKCcwNy4zMS4yMDE5JykudG9JU09TdHJpbmcoKSxcclxuICAgIH07XHJcbiAgICBpZiAocmFuZG9tICUgMyA9PT0gMCkge1xyXG4gICAgICB3YW50ZWQudXNlciA9IG51bGw7XHJcbiAgICAgIHdhbnRlZC50eXBlID0gJ2Nhcic7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3YW50ZWQuY2FyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBtZXNzYWdlID0ge1xyXG4gICAgICBtZXNzYWdlVHlwZTogJ3dhbnRlZCcsXHJcbiAgICAgIHRvOiB7IGNoYXRUeXBlOiAncHJpdmF0ZScsIGNoYXRJZDogY2hhdElkIH0sXHJcbiAgICAgIHdhbnRlZDogd2FudGVkLFxyXG4gICAgICB0ZXh0OiBudWxsLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGF3YWl0IG1lc3NlbmdlclxyXG4gICAgLnNlbmRNZXNzYWdlKG1lc3NhZ2UpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlcywgJ1N1Y2Nlc3Mgc2VuZGVkJyk7XHJcbiAgICAgIHJldHVybiByZXMuZGF0YTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIucmVzcG9uc2U/LmRhdGEsICdlcnInKTtcclxuICAgIH0pO1xyXG59LCAxXzAwMCk7XHJcbiJdfQ==