var _a;
import { ENV } from '../../common/config';
import { decrypt, encrypt } from '../crypto';
let localStorage;
if (ENV.isBrowser) {
    localStorage = window.localStorage;
}
else {
    const map = new Map();
    localStorage = {
        clear() {
            map.clear();
            return map;
        },
        getItem(key) {
            return map.get(key);
        },
        removeItem(key) {
            map.delete(key);
            return map;
        },
        setItem(key, value) {
            map.set(key, value);
            return map;
        },
    };
}
const secret = (_a = localStorage.getItem('accessHash')) !== null && _a !== void 0 ? _a : undefined;
function createLocalStorage() {
    /** The default cache period is 7 days */
    const DEFAULT_CACHE_TIME = 60 * 60 * 24 * 7;
    function set(key, value, expire = DEFAULT_CACHE_TIME) {
        const storageData = {
            value,
            expire: expire !== null ? new Date().getTime() + expire * 1000 : null,
        };
        localStorage.setItem(key, encrypt(storageData, secret));
    }
    function get(key) {
        const json = localStorage.getItem(key);
        if (!json) {
            return null;
        }
        let storageData = null;
        try {
            storageData = decrypt(json, secret);
        }
        catch (_a) {
            // Prevent parsing failure
        }
        if (!storageData) {
            remove(key);
            return null;
        }
        const { value, expire } = storageData;
        // Return directly within the validity period
        if (!(expire === null || expire >= Date.now())) {
            return null;
        }
        return value;
    }
    function remove(key) {
        localStorage.removeItem(key);
    }
    function clear() {
        localStorage.clear();
    }
    return {
        set,
        get,
        remove,
        clear,
    };
}
export const localStg = createLocalStorage();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdXRpbHMvc3RvcmFnZS9sb2NhbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBTzdDLElBQUksWUFLSCxDQUFDO0FBQ0YsSUFBSSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbEIsWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7QUFDckMsQ0FBQztLQUFNLENBQUM7SUFDTixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLFlBQVksR0FBRztRQUNiLEtBQUs7WUFDSCxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDWixPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUM7UUFDRCxPQUFPLENBQUMsR0FBRztZQUNULE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QixDQUFDO1FBQ0QsVUFBVSxDQUFDLEdBQUc7WUFDWixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hCLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQztRQUNELE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSztZQUNoQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNwQixPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUM7S0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sTUFBTSxHQUFHLE1BQUEsWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsbUNBQUksU0FBUyxDQUFDO0FBRS9ELFNBQVMsa0JBQWtCO0lBQ3pCLHlDQUF5QztJQUN6QyxNQUFNLGtCQUFrQixHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUU1QyxTQUFTLEdBQUcsQ0FBb0IsR0FBTSxFQUFFLEtBQVcsRUFBRSxTQUF3QixrQkFBa0I7UUFDN0YsTUFBTSxXQUFXLEdBQXNCO1lBQ3JDLEtBQUs7WUFDTCxNQUFNLEVBQUUsTUFBTSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJO1NBQ3RFLENBQUM7UUFFRixZQUFZLENBQUMsT0FBTyxDQUFDLEdBQWEsRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVELFNBQVMsR0FBRyxDQUFvQixHQUFNO1FBQ3BDLE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBYSxDQUFDLENBQUM7UUFDakQsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ1YsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsSUFBSSxXQUFXLEdBQTZCLElBQUksQ0FBQztRQUNqRCxJQUFJLENBQUM7WUFDSCxXQUFXLEdBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN0QyxDQUFDO1FBQUMsV0FBTSxDQUFDO1lBQ1AsMEJBQTBCO1FBQzVCLENBQUM7UUFDRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ1osT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUM7UUFDdEMsNkNBQTZDO1FBQzdDLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxJQUFJLElBQUksTUFBTSxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDL0MsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsU0FBUyxNQUFNLENBQUMsR0FBWTtRQUMxQixZQUFZLENBQUMsVUFBVSxDQUFDLEdBQWEsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxTQUFTLEtBQUs7UUFDWixZQUFZLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVELE9BQU87UUFDTCxHQUFHO1FBQ0gsR0FBRztRQUNILE1BQU07UUFDTixLQUFLO0tBQ04sQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsa0JBQWtCLEVBQWlCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFTlYgfSBmcm9tICcuLi8uLi9jb21tb24vY29uZmlnJztcclxuaW1wb3J0IHsgSUxvY2FsU3RvcmFnZSB9IGZyb20gJy4uLy4uL3R5cGVzL3N0b3JhZ2UnO1xyXG5pbXBvcnQgeyBkZWNyeXB0LCBlbmNyeXB0IH0gZnJvbSAnLi4vY3J5cHRvJztcclxuXHJcbmludGVyZmFjZSBTdG9yYWdlRGF0YTxUPiB7XHJcbiAgdmFsdWU6IFQ7XHJcbiAgZXhwaXJlOiBudW1iZXIgfCBudWxsO1xyXG59XHJcblxyXG5sZXQgbG9jYWxTdG9yYWdlOiB7XHJcbiAgc2V0SXRlbTogKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSA9PiB2b2lkO1xyXG4gIGdldEl0ZW06IChrZXk6IHN0cmluZykgPT4gc3RyaW5nO1xyXG4gIHJlbW92ZUl0ZW06IChrZXk6IHN0cmluZykgPT4gdm9pZDtcclxuICBjbGVhcjogKCkgPT4gdm9pZDtcclxufTtcclxuaWYgKEVOVi5pc0Jyb3dzZXIpIHtcclxuICBsb2NhbFN0b3JhZ2UgPSB3aW5kb3cubG9jYWxTdG9yYWdlO1xyXG59IGVsc2Uge1xyXG4gIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTtcclxuICBsb2NhbFN0b3JhZ2UgPSB7XHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgbWFwLmNsZWFyKCk7XHJcbiAgICAgIHJldHVybiBtYXA7XHJcbiAgICB9LFxyXG4gICAgZ2V0SXRlbShrZXkpIHtcclxuICAgICAgcmV0dXJuIG1hcC5nZXQoa2V5KTtcclxuICAgIH0sXHJcbiAgICByZW1vdmVJdGVtKGtleSkge1xyXG4gICAgICBtYXAuZGVsZXRlKGtleSk7XHJcbiAgICAgIHJldHVybiBtYXA7XHJcbiAgICB9LFxyXG4gICAgc2V0SXRlbShrZXksIHZhbHVlKSB7XHJcbiAgICAgIG1hcC5zZXQoa2V5LCB2YWx1ZSk7XHJcbiAgICAgIHJldHVybiBtYXA7XHJcbiAgICB9LFxyXG4gIH07XHJcbn1cclxuXHJcbmNvbnN0IHNlY3JldCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NIYXNoJykgPz8gdW5kZWZpbmVkO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlTG9jYWxTdG9yYWdlPFQgZXh0ZW5kcyBJTG9jYWxTdG9yYWdlID0gSUxvY2FsU3RvcmFnZT4oKSB7XHJcbiAgLyoqIFRoZSBkZWZhdWx0IGNhY2hlIHBlcmlvZCBpcyA3IGRheXMgKi9cclxuICBjb25zdCBERUZBVUxUX0NBQ0hFX1RJTUUgPSA2MCAqIDYwICogMjQgKiA3O1xyXG5cclxuICBmdW5jdGlvbiBzZXQ8SyBleHRlbmRzIGtleW9mIFQ+KGtleTogSywgdmFsdWU6IFRbS10sIGV4cGlyZTogbnVtYmVyIHwgbnVsbCA9IERFRkFVTFRfQ0FDSEVfVElNRSkge1xyXG4gICAgY29uc3Qgc3RvcmFnZURhdGE6IFN0b3JhZ2VEYXRhPFRbS10+ID0ge1xyXG4gICAgICB2YWx1ZSxcclxuICAgICAgZXhwaXJlOiBleHBpcmUgIT09IG51bGwgPyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIGV4cGlyZSAqIDEwMDAgOiBudWxsLFxyXG4gICAgfTtcclxuXHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXkgYXMgc3RyaW5nLCBlbmNyeXB0KHN0b3JhZ2VEYXRhLCBzZWNyZXQpKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldDxLIGV4dGVuZHMga2V5b2YgVD4oa2V5OiBLKSB7XHJcbiAgICBjb25zdCBqc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5IGFzIHN0cmluZyk7XHJcbiAgICBpZiAoIWpzb24pIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHN0b3JhZ2VEYXRhOiBTdG9yYWdlRGF0YTxUW0tdPiB8IG51bGwgPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3RvcmFnZURhdGEgPSBkZWNyeXB0KGpzb24sIHNlY3JldCk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgLy8gUHJldmVudCBwYXJzaW5nIGZhaWx1cmVcclxuICAgIH1cclxuICAgIGlmICghc3RvcmFnZURhdGEpIHtcclxuICAgICAgcmVtb3ZlKGtleSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgdmFsdWUsIGV4cGlyZSB9ID0gc3RvcmFnZURhdGE7XHJcbiAgICAvLyBSZXR1cm4gZGlyZWN0bHkgd2l0aGluIHRoZSB2YWxpZGl0eSBwZXJpb2RcclxuICAgIGlmICghKGV4cGlyZSA9PT0gbnVsbCB8fCBleHBpcmUgPj0gRGF0ZS5ub3coKSkpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVtb3ZlKGtleToga2V5b2YgVCkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5IGFzIHN0cmluZyk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjbGVhcigpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHNldCxcclxuICAgIGdldCxcclxuICAgIHJlbW92ZSxcclxuICAgIGNsZWFyLFxyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsb2NhbFN0ZyA9IGNyZWF0ZUxvY2FsU3RvcmFnZTxJTG9jYWxTdG9yYWdlPigpO1xyXG4iXX0=